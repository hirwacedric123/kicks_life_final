{% extends "authentication/base.html" %}
{% load static %}

{% block title %}Edit Product - {{ product.title }} - KoraQuest{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <div class="row fade-in">
        <div class="col-12 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold">Edit Product</h5>
                    <a href="{% url 'vendor_dashboard' %}" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-x-lg"></i> Cancel
                    </a>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <label for="title" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="title" name="title" value="{{ product.title }}" required>
                            <div class="form-text">
                                A clear and concise name for your product
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="description" class="form-label">Product Description</label>
                            <textarea class="form-control" id="description" name="description" rows="5" required>{{ product.description }}</textarea>
                            <div class="form-text">
                                Describe your product features, specifications, and other relevant details
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="price" class="form-label">Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">RWF</span>
                                    <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" value="{{ product.price }}" required>
                                </div>
                                <div class="form-text">
                                    Product price in USD
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="" disabled>Select category</option>
                                    <option value="Electronics" {% if product.category == 'Electronics' %}selected{% endif %}>Electronics</option>
                                    <option value="Clothing" {% if product.category == 'Clothing' %}selected{% endif %}>Clothing</option>
                                    <option value="Home & Kitchen" {% if product.category == 'Home & Kitchen' %}selected{% endif %}>Home & Kitchen</option>
                                    <option value="Beauty & Personal Care" {% if product.category == 'Beauty & Personal Care' %}selected{% endif %}>Beauty & Personal Care</option>
                                    <option value="Health & Fitness" {% if product.category == 'Health & Fitness' %}selected{% endif %}>Health & Fitness</option>
                                    <option value="Books & Media" {% if product.category == 'Books & Media' %}selected{% endif %}>Books & Media</option>
                                    <option value="Software & Services" {% if product.category == 'Software & Services' %}selected{% endif %}>Software & Services</option>
                                    <option value="Other" {% if product.category == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="inventory" class="form-label">Quantity in Stock</label>
                            <input type="number" class="form-control" id="inventory" name="inventory" min="1" value="{{ product.inventory }}" required>
                            <div class="form-text">
                                Number of items available for purchase
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="main_image" class="form-label">Main Product Image</label>
                            {% if product.image %}
                            <div class="mb-2">
                                <img src="{{ product.image.url }}" alt="{{ product.title }}" style="max-height: 150px; object-fit: contain;">
                                <p class="form-text">Current main image</p>
                            </div>
                            {% endif %}
                            <input type="file" class="form-control" id="main_image" name="main_image" accept="image/*" onchange="previewMainImage(this)">
                            <div id="main-image-preview" class="mt-2"></div>
                            <div class="form-text">
                                Upload a new main image to replace the current one (optional)
                            </div>
                        </div>
                        
                        <!-- Auxiliary Images Section -->
                        <div class="mb-4">
                            <label class="form-label">Additional Product Images (Gallery)</label>
                            
                            {% if auxiliary_images %}
                            <div class="row mb-3">
                                <div class="col-12">
                                    <h6 class="text-muted mb-2">Current gallery images:</h6>
                                </div>
                                {% for aux_image in auxiliary_images %}
                                <div class="col-md-3 mb-2">
                                    <div class="card">
                                        <img src="{{ aux_image.image.url }}" class="card-img-top" alt="Product image {{ forloop.counter }}" style="height: 120px; object-fit: cover;">
                                        <div class="card-body p-2">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="keep_image_{{ aux_image.id }}" name="keep_auxiliary_image" value="{{ aux_image.id }}" checked>
                                                <label class="form-check-label" for="keep_image_{{ aux_image.id }}">
                                                    Keep this image
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="text-muted mb-3">No additional images currently.</p>
                            {% endif %}
                            
                            <div class="card border-light bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title">Add new gallery images</h6>
                                    
                                    <p class="text-muted">You can add up to {% if auxiliary_images %}{{ 5|add:"-"|add:auxiliary_images|length }}{% else %}5{% endif %} more images (maximum 5 total).</p>
                                    
                                    <div class="mb-3">
                                        <label for="auxiliary_images" class="form-label fw-bold">Select multiple images:</label>
                                        <input type="file" class="form-control" id="auxiliary_images" name="auxiliary_images" accept="image/*" multiple>
                                    </div>
                                    
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle-fill me-2"></i>
                                        <strong>Tip:</strong> To select multiple images, hold down the Ctrl key (or Command key on Mac) while clicking on the files you want to upload.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'vendor_dashboard' %}" class="btn btn-outline-secondary me-md-2">Cancel</a>
                            <button type="submit" class="btn btn-primary">Update Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Preview main product image
    function previewMainImage(input) {
        const previewContainer = document.getElementById('main-image-preview');
        previewContainer.innerHTML = '';
        
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const preview = document.createElement('div');
                preview.classList.add('main-preview');
                preview.innerHTML = `
                    <p class="text-success mb-1"><i class="bi bi-check-circle"></i> New main image preview:</p>
                    <img src="${e.target.result}" alt="Main image preview" style="max-height: 150px; max-width: 100%; object-fit: contain; border-radius: 4px;">
                `;
                previewContainer.appendChild(preview);
            };
            
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    // Initialize components when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Set up event listeners
        document.getElementById('main_image').addEventListener('change', function() {
            previewMainImage(this);
        });
    });
</script>
{% endblock %} 